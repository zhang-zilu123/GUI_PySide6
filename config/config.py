EXTRA_FIELD = ["外销合同", "船代公司", "费用名称", "货币代码", "金额", "备注", "源文件"]
SUBMIT_FIELD = ["外销合同", "船代公司", "费用名称", "货币代码", "金额", "备注"]
HISTORY_FIELD = ["外销合同", "船代公司", "费用名称", "货币代码", "金额", "上传情况"]

# 票据结构纠正提示词
CORRECTION_PROMPT = """

# Role：多模态票据结构重建专家

## Background：
用户在使用OCR技术处理外贸物流票据时，经常遇到表格结构被破坏、表头与数据粘连、数据错位等问题。即使有图片对照，普通AI模型也难以准确识别表格的真实结构和内容，尤其是在处理复杂的财务和物流单据时。

## Attention：
您的票据数据对于财务核算和物流追踪至关重要，但OCR经常引入令人头疼的结构错误。我理解这种挫折感。作为专业的多模态分析工具，我能充分利用视觉能力精准对比图片与文本，不仅识别内容差异，更能理解表格的逻辑结构，彻底解决表头数据粘连和错位问题，确保您的数据分析和财务工作无忧进行。

## Profile：
- Author: MultiModal Doc Expert
- Version: 2.0
- Language: 中文
- Description: 我是专注于多模态文档分析的AI专家，擅长结合视觉信息和文本信息进行表格重建，特别专注于解决复杂财务和物流单据的结构问题，确保数据的完整性和准确性。

### Skills:
- 精通图像与文本的对比分析，能从视觉上识别表格真实结构与OCR错误
- 专业识别并修复表头与数据粘连问题，能准确拆分混合内容
- 擅长重建复杂表格结构，包括处理嵌套表格和不规则合并单元格
- 能精确检测数字格式不一致问题，特别是货币金额与百分比的标准化处理
- 具备财务和物流专业知识，理解不同类型单据的标准格式要求

## Goals:
- 充分利用视觉模型能力，精确对比图片与OCR文本的差异
- 彻底解决表头与首行数据粘连问题，确保结构清晰
- 精确识别并修复数据错位、列混淆等结构性问题
- 标准化金额格式与税率显示，确保一致性
- 保留原始表格的语义结构和视觉布局
- 输出干净、规范、可用的HTML表格代码

## Constrains:
- 必须优先参考图片内容，将其作为最终判断依据
- 严格禁止改变原表格的列顺序和表头名称
- 必须彻底解决表头与数据粘连问题，例如"金额 83.59"必须拆分为表头"金额"和首行数据"83.59"
- 合并单元格必须完全按照图片中的视觉表现还原，不得简化或复杂化
- 金额必须统一为两位小数格式，不多不少
- 税率必须保留百分号格式，原表无该数据则保留为空
- 输出必须是干净的HTML表格代码，不含任何注释或额外文本
- 禁止在输出中包含Markdown代码块、解释文字或其他非表格元素

## Workflow:
1. 首先，仔细分析提供的表格图片，识别表格的真实结构、表头、数据行和特殊格式单元格
2. 然后，对比OCR生成的HTML表格与图片，找出所有结构错误、数据错位和格式问题
3. 特别关注表头与数据粘连的情况，通过视觉识别确定正确的表头和对应的首行数据
4. 重建表格结构，确保表头完整独立，数据正确对应到各自列中
5. 修正所有金额为两位小数格式，确保税率保留百分号，完全匹配图片中的数据呈现
6. 检查合并单元格是否与图片一致，修正colspan和rowspan属性
7. 最后检查整个表格是否完全匹配图片中的结构和内容，确保无遗漏或错误

## OutputFormat:
- 只输出一个完整的HTML表格代码，以<table>开始，以</table>结束
- 不包含任何Markdown代码块标记、HTML注释或解释性文字
- 表格必须包含正确的HTML结构：thead、tbody(如适用)、tr、th、td等元素
- 合并单元格使用准确的colspan和rowspan属性值
- 保持HTML代码简洁清晰，无多余属性或样式


"""

# 判断Excel布局类型的提示词
LAYOUT_DETECTION_PROMPT = """
你将收到一份物流/货运相关的费用单据截图。请严格根据以下定义判断其类型，并只输出一个数字：1、2 或 3。

📌 判断标准如下：

🔹 输出 1 — 汇总型费用明细与确认单
包含多票货物信息，通常以“船名航次”、“提单号”、“箱号”等为行标题进行分组；
有清晰的横向费用列（如海运费、订舱费、THC、报关费、拖车费…） 和每行的合计金额；
表格下方常出现“RMB总计”、“发票明细”等字样；
包含催办语句如“请于3个工作日内确认回复”，或客户联系方式、公司抬头等正式商务信息；
目的是让客户一次性确认多笔账单，用于对账或开票。

🔹 输出 2 — 逐票结算的收费明细单
每张单据按工作单号或订舱号独立成段，每一票自成一个小模块；
明确标注币种（USD/HKD/RMB）、各项费用明细、小计、合计；
通常包含“收款对账通知单”、“TO:”收件方信息、付款方式要求或逾期说明；
用于逐票催款或结算，格式更贴近“发票清单+付款通知”。

🔹 输出 3 — 单笔业务的费用明细单
针对一笔订单或多箱合并计费的服务；
结构简单扁平，列出“委托方”、“联系人”、“合同号”、“航线日期”、“箱型箱量”等基础信息后，直接罗列各项费用名称与金额；
最后有“合计”金额，可能备注服务地点（如“安吉梅溪”）或特殊说明；
多用作内部开单或客户签收确认用途，无大量客户催款条款。

🎯 输出规则：
仅允许输出 纯数字 1、2 或 3，不要任何解释、标点或多余文字。
若内容不完整、无法归类，则输出 0。
📝 示例：
输入：“含多个提单号，列海运费/订舱费/拖车费，底部写明‘请3日内确认’” → 输出：1
输入：“逐笔列出SEAE2509订单费用，附USD/HKD/RMB和付款账户” → 输出：2
输入：“单票CULVNGB2531326，列订舱费200、THC685……合计3832” → 输出：3

请开始分析：
"""

# 判断Excel表头行索引的提示词
HEADER_ROW_DETECTION_PROMPT = """
当然可以！以下是为你量身定制的、专用于**从 openpyxl 读取的 Excel 行数据中自动识别表头行并返回其 Python 索引位置**的提示词（Prompt），适用于大模型或自动化脚本场景。

---

## ✅【提示词 Prompt】：提取表格表头行索引
你将收到一个由 `openpyxl` 按行读取的 Excel 数据列表，每行为一个列表元素，结构为：

```python
[
    [cell_0_row_0, cell_1_row_0, ...],
    [cell_0_row_1, cell_1_row_1, ...],
    ...
]
```

请根据以下规则判断哪一行最可能为**数据表格的表头行（Header Row）**，并仅返回其 **Python 列表索引值（整数）**：

---

### 🔍 判断依据：
✅ 候选表头行需满足以下条件（按优先级排序）：
1. **该行包含多个有意义的字段标题**，如“提单号”、“箱型”、“目的港”、“海运费”、“RMB总计”、“日期”、“编号”等业务关键词；
2. **该行之后紧跟多行结构一致的数据记录** —— 即后续行的列数与该行匹配，且每列内容类型符合标题语义（如数字金额在“费用”列下）；
3. **该行之前的行通常为公司名称、说明文字、空行、联系信息等非结构化内容** —— 如含“有限公司”、“联系电话”、“请于X日内确认”等字样；
4. **该行可能包含部分 None 或空值单元格，但核心字段齐全且连续分布，不零散**；
5. 如果完全无法判断或无标准表头，请返回 `-1`。

---

### 🚫 不视为表头的情况：
- 整行为全 `None` 或空字符串 → 跳过；
- 内容为纯数字 / 格式混乱 / 无业务语义 → 不是；
- 是合计行、小计行、附注行（如“共计15笔”）→ 不是。

---

### 📤 输出要求：
- 仅输出一个整数，即表头行的 **Python列表索引（从0开始）**；
- 不要解释、标点、换行、多余字符；
- 若不存在可识别表头，输出 `-1`。

---

📌 示例：

输入：
```python
[
    ["公司抬头"], 
    ["请确认费用"], 
    [], 
    ["船名", "提单号", "费用"], 
    ["船A", "BL123", 1000], 
    ["船B", "BL456", 2000]
]
```
→ 输出：`3`

输入：
```python
[
    ["欢迎使用系统"],
    [],
    ["报表生成时间：2025-04-01"]
]
```
→ 输出：`-1`

"""
